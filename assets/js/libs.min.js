jQuery(function(t){"use strict";var e=t(document);t.fn.ltfwImagePicker=function(){var n={},i=function(t){var e=[];if(""!=t){var n=t.split(",");for(var i in n){var a=n[i].split("|");e.push(a[0])}}return e};e.on("click",".long-toolkit-image_picker .add_images",function(e){e.preventDefault();var a=t(this).closest(".long-toolkit-image_picker"),l=a.find('input[type="hidden"]');n[a.attr("id")]?n[a.attr("id")].open():(n[a.attr("id")]=wp.media.frames.file_frame=wp.media({title:"Add Images",button:{text:"Add Images"},library:{type:"image"},multiple:a.data("multiple")}),n[a.attr("id")].on("open",function(){var e,o;""!=(e=i(l.val()))&&(o=n[a.attr("id")].state().get("selection"),t(e).each(function(t,e){var n;(n=wp.media.attachment(e)).fetch(),o.add(n?[n]:[])}))}),n[a.attr("id")].on("select",function(){var e,o;e=[],o=n[a.attr("id")].state().get("selection");var r=i(l.val()),s="";o.map(function(n){var i=(n=n.toJSON()).sizes.hasOwnProperty("thumbnail")?n.sizes.thumbnail.url:n.url;""!=r&&-1!==t.inArray(n.id.toString(),r)||(s+='<li class="added" data-id="'+n.id+'">\n                                    <div class="inner">\n                                        <img alt="'+n.title+'" src="'+i+'"/>\n                                    </div>\n                                    <a href="#" class="remove"></a>\n                                </li>',i=i.replace(long_toolkit_var.upload_url,""),e.push(n.id+"|"+encodeURIComponent(i)))}),e.length>0&&(a.data("multiple")?(""!=r&&(e=r.concat(e)),a.find(".image_list").append(s)):a.find(".image_list").html(s),l.val(e).change())}),n[a.attr("id")].open())}),e.on("click",".long-toolkit-image_picker .remove",function(e){e.preventDefault();var n=t(this),i=n.closest(".long-toolkit-image_picker").find('input[type="hidden"]'),a=i.val(),l=n.closest("li").index();""!=a&&(delete(a=a.split(","))[l],a=a.filter(function(t){return t})),i.val(a).change(),n.closest("li").remove()}),t.fn.sortable&&t(".long-toolkit-image_picker .image_list").sortable({stop:function(e,n){var i=[],a=t(n.item[0]).parent();a.find("li").each(function(){i.push(t(this).attr("data-id"))}),a.closest(".long-toolkit-image_picker").find('input[type="hidden"]').val(i)}})},t.fn.ltfwLink=function(){e.on("click",".long-toolkit-link .link_button",function(e){var n,i,a,l,o,r,s,p,c;e.preventDefault(),n=t(this).closest(".long-toolkit-link"),i=n.find("input.long_toolkit_value"),a=n.find(".url-label"),l=n.find(".title-label"),o=i.data("json"),r=t("#wp-link-submit"),s=t('<input type="button" name="long_toolkit_link-submit" id="long_toolkit_link-submit" class="button-primary" value="Set Link">'),r.hide(),t("#long_toolkit_link-submit").remove(),s.insertBefore(r),p=t('<div class="link-target long-toolkit-link-nofollow"><label><span></span> <input type="checkbox" id="long-toolkit-link-nofollow"> Add nofollow option to link</label></div>'),t("#link-options .long-toolkit-link-nofollow").remove(),p.insertAfter(t("#link-options .link-target")),setTimeout(function(){var e=t("#most-recent-results").css("top");t("#most-recent-results").css("top",parseInt(e)+p.height())},200),(c=window.wpLink).open("content"),"string"==typeof o.url&&t("#wp-link-url").length?t("#wp-link-url").val(o.url):t("#url-field").val(o.url),"string"==typeof o.url&&t("#wp-link-text").length?t("#wp-link-text").val(o.title):t("#link-title-field").val(o.title),t("#wp-link-target").length?t("#wp-link-target").prop("checked",o.target.length):t("#link-target-checkbox").prop("checked",o.target.length),t("#long-toolkit-link-nofollow").length&&t("#long-toolkit-link-nofollow").prop("checked",o.rel.length),s.unbind("click.ltfwLink").bind("click.ltfwLink",function(e){e.preventDefault(),e.stopImmediatePropagation();var n,o={};o.url=t("#wp-link-url").length?t("#wp-link-url").val():t("#url-field").val(),o.title=t("#wp-link-text").length?t("#wp-link-text").val():t("#link-title-field").val();var p=t(t("#wp-link-target").length?"#wp-link-target":"#link-target-checkbox");return o.target=p[0].checked?" _blank":"",o.rel=t("#long-toolkit-link-nofollow")[0].checked?"nofollow":"",n=t.map(o,function(t,e){return"string"==typeof t&&0<t.length?e+":"+encodeURIComponent(t):void 0}).join("|"),i.val(n).change(),i.data("json",o),a.html(o.url+o.target),l.html(o.title),c.close("noReset"),window.wpLink.textarea="",r.show(),s.unbind("click.ltfwLink"),s.remove(),t("#wp-link-cancel").unbind("click.ltfwLink"),p.attr("checked",!1),t("#most-recent-results").css("top",""),t("#long-toolkit-link-nofollow").attr("checked",!1),!1}),t("#wp-link-cancel").unbind("click.ltfwLink").bind("click.ltfwLink",function(e){return e.preventDefault(),c.close("noReset"),s.unbind("click.ltfwLink"),s.remove(),t("#wp-link-cancel").unbind("click.ltfwLink"),t("#wp-link-close").unbind("click.ltfwCloseLink"),window.wpLink.textarea="",!1}),t("#wp-link-close").unbind("click").bind("click.ltfwCloseLink",function(e){return e.preventDefault(),c.close("noReset"),s.unbind("click.ltfwLink"),s.remove(),t("#wp-link-cancel").unbind("click.ltfwLink"),t("#wp-link-close").unbind("click.ltfwCloseLink"),window.wpLink.textarea="",!1})})},t.fn.ltfwMap=function(){if(window.hasOwnProperty("google"))return this.each(function(e,n){if(!n.id.includes("__i__")){var i=t(this),a={zoom:14};a.map=new google.maps.Map(i.find(".map_canvas")[0],{zoom:4,center:new google.maps.LatLng(40.590377,-97.726872)}),a.marker=null,a.overideMap=function(t){null!=a.marker&&(a.marker.setMap(null),a.marker=null),a.marker=new google.maps.Marker({position:t,draggable:!0,animation:google.maps.Animation.DROP,icon:a.iconMarker}),a.map.setCenter(t),a.map.setZoom(a.zoom),a.marker.setMap(a.map),google.maps.event.addListener(a.marker,"dragend",a.onDragMarker),google.maps.event.addListener(a.map,"zoom_changed",a.onZoomChanged)},a.onDragMarker=function(t){var e=t.latLng,n=e.lat()+","+e.lng()+"|"+a.zoom;i.find("input.long_toolkit_value").val(n).change()},a.onZoomChanged=function(e){a.zoom=a.map.getZoom();var n=i.find("input.long_toolkit_value").val();if(""!=t.trim(n)){var l=(n=n.split("|"))[0]+"|"+a.zoom;i.find("input.long_toolkit_value").val(l).change()}},a.onLoad=function(){var e=i.find("input.long_toolkit_value").val();if(i.addClass("map_loaded"),""!=t.trim(e)){var n=(e=e.split("|"))[0].split(",");n=new google.maps.LatLng(t.trim(n[0]),t.trim(n[1])),a.zoom=""!=t.trim(e[1])?parseInt(e[1]):14,a.overideMap(n)}},i.find(".js-map_search").geocomplete().bind("geocode:result",function(t,e){var n=e.geometry.location,l=n.lat()+","+n.lng()+"|"+a.zoom;i.find("input.long_toolkit_value").val(l).change(),a.overideMap(n)}),setTimeout(a.onLoad,500)}})},t.fn.ltfwRepeater=function(){t(this).each(function(){var e=t(this).repeater({defaultValues:{},show:function(){t(this).slideDown()},hide:function(e){t(this).slideUp(e)},ready:function(t){},render:{image_picker:function(e,n,i){var a=i.split(",");if(a.length>0){var l="";t.each(a,function(t,e){2===(e=e.split("|")).length&&(l+='<li class="added" data-id="'+e[0]+'">\n                                                    <div class="inner">\n                                                        <img alt="" src="'+long_toolkit_var.upload_url+decodeURIComponent(e[1])+'"/>\n                                                    </div>\n                                                    <a href="#" class="remove"></a>\n                                                </li>')}),e.parent().find(".image_list").append(l)}},color_picker:function(e,n,i){e.val(i),e.wpColorPicker({change:function(e,n){t(e.target).val(n.color.toString()).change()}})},icon_picker:function(t,e,n){t.val(n).change(),t.fontIconPicker()},checkbox:function(t,e,n){if(""!=n){n=n.split(",");var i=t.next();for(var a in n)i.find('input[value="'+n[a]+'"]').attr("checked","checked")}},select:function(e,n,i){var a=e.parent().find("select");if(""!=i){"string"==typeof i&&(i=i.split(","));for(var l in i)a.find('option[value="'+i[l]+'"]').attr("selected","selected");a.change()}void 0!==a.attr("multiple")&&a.selectize({plugins:["remove_button","drag_drop"],onChange:function(e){t(this)[0].$wrapper.closest(".repeater-col-field").find("input.long_toolkit_value").val(e).change()}})},autocomplete:function(t,e,n){var i=t.parent().find("select");if(""!=n){"string"==typeof n&&(n=n.split(","));for(var a in n)i.find('option[value="'+n[a]+'"]').attr("selected","selected");i.change()}i.ltfwAutocomplete()},link:function(t,e,n){var i=n.split("|"),a={};if(i.length>1){for(var l in i){var o=i[l].split(":");a[o[0]]=decodeURIComponent(o[1])}t.data("json",a),t.parent().find(".url-label").html(a.url+a.target),t.parent().find(".title-label").html(a.title)}},datetime:function(t,e,n){t.datetimepicker(t.data())}}}),n=e.data("value");"object"==typeof n&&e.setList(n),e.find("div[data-rpt_dependency]").length&&e.find("div[data-rpt_dependency]").initRepeaterDependency()}),e.on("click",".long-toolkit-repeater [data-repeater-edit], .long-toolkit-repeater .long-toolkit-widget-title h4",function(n){var i=t(this).closest(".long-toolkit-widget");i.hasClass("open")?i.find(".long-toolkit-widget-inside").slideUp("fast",function(){i.removeClass("open")}):i.find(".long-toolkit-widget-inside").slideDown("fast",function(){i.addClass("open"),e.trigger("long-toolkit-repeater-item-opened",[i])}),n.preventDefault()})},t.fn.ltfwTypography=function(){var e={},n=!1,i=function(e,n,i){var a={"font-family":n.value},l=e.find(".subsets select"),o=e.find(".variants select"),r=l[0].selectize,s=o[0].selectize;if(""!=n.variants){var p=n.variants.split(","),c=[],f=long_toolkit_var.variants;for(var d in n.variants){var u=f.hasOwnProperty(p[d])?f[p[d]]:p[d];c.push({text:u,value:p[d]})}if(s.enable(),s.clearOptions(),s.addOption(c),"object"==typeof i&&i.hasOwnProperty("variants")){var v=i.variants.split(",");s.addItems(v)}else s.addItems(p);a.variants=n.variants}else s.clearOptions(),s.disable();if(""!=n.subsets){var h=n.subsets.split(","),m=(c=[],long_toolkit_var.subsets);for(var d in h){u=m.hasOwnProperty(h[d])?m[h[d]]:h[d];c.push({text:u,value:h[d]})}if(r.enable(),r.clearOptions(),r.addOption(c),"object"==typeof i&&i.hasOwnProperty("subsets")){var w=i.subsets.split(",");r.addItems(w)}else t.inArray("latin",h)>=0&&(r.addItem("latin"),a.subsets="latin")}else r.clearOptions(),r.disable();"function"==typeof i&&i(a)},a=t(this),l=a.find(".font_family select");a.find(".variants select").selectize({plugins:["remove_button"],create:!1,onChange:function(i){if(!n){var a=t(this)[0].$wrapper.closest(".long-toolkit-typography"),l=a.data("id"),o=e[l];if(""!=a.data("value")&&o.hasOwnProperty("variants")){o.variants=i.join(",");var r=encodeURIComponent(JSON.stringify(o));e[l]=o,a.find(".long_toolkit_value").val(r).change()}}}}),a.find(".subsets select").selectize({plugins:["remove_button"],create:!1,onChange:function(i){if(!n){var a=t(this)[0].$wrapper.closest(".long-toolkit-typography"),l=a.data("id"),o=e[l];if(""!=a.data("value")&&o.hasOwnProperty("subsets")){o.subsets=i.join(",");var r=encodeURIComponent(JSON.stringify(o));e[l]=o,a.find(".long_toolkit_value").val(r).change()}}}}),l.selectize({labelField:"label",valueField:"value",searchField:"label",create:!1,options:long_toolkit_var.fonts,render:{option:function(t,e){return"<div class='option' data-value='"+t.value+"' data-variants='"+t.variants+"' data-subsets='"+t.subsets+"'>"+t.label+" </div>"}},onInitialize:function(){var n=t(this)[0].$wrapper.closest(".long-toolkit-typography"),i=n.data("id");e[i]={};var a=n.data("value");if(""!=a){var l=JSON.parse(decodeURIComponent(a));l.hasOwnProperty("font-family")&&(e[i]=l,t(this)[0].addItem(l["font-family"]))}},onChange:function(a){if(n=!0,""!=a){var l=t(this)[0].$wrapper.closest(".long-toolkit-typography"),o=l.data("id"),r=e[o];r.hasOwnProperty("font-family")&&r["font-family"]===a?i(l,this.options[a],r):i(l,this.options[a],function(t){r["font-family"]=t["font-family"],r.subsets=t.subsets,r.variants=t.variants;var n=encodeURIComponent(JSON.stringify(r));l.find(".long_toolkit_value").val(n).change(),e[o]=r}),n=!1}}}),a.on("change",".subrow input, .subrow select",function(n){var i=t(this).data("key"),a=t(this),l=a.closest(".long-toolkit-typography"),o=l.data("id");if(""!=a.val()){e[o][i]=a.val();var r=encodeURIComponent(JSON.stringify(e[o]));l.find(".long_toolkit_value").val(r).change()}n.preventDefault()})},t.fn.ltfwAutocomplete=function(){t(this).selectize({valueField:"value",searchField:"label",labelField:"label",options:[],create:!1,plugins:["remove_button","drag_drop"],load:function(e,n){var i=t(this)[0].$wrapper.closest(".long-toolkit-field"),a=i.data("ajax_type"),l=i.data("min_length");if(e.length<parseInt(l)||!a)return n();var o=i.data("ajax_value");t.ajax({url:ajaxurl,type:"GET",data:{action:"long_toolkit_autocomplete_"+a,types:o,s:e},error:function(){n()},success:function(t){n(t)}})}})},t.fn.ltfwUpload=function(){var e=t(this);e.on("change",".long_toolkit_value",function(e){var n=t(this),i=[];n.closest(".long-toolkit-field").find("tbody tr").each(function(){var e=t(this);i.push({url:e.find('[data-name="url"]').val(),name:e.find('[data-name="name"]').val(),hash:e.find('[data-name="hash"]').val()})}),1==i.length&&""==i[0].url?n.val(""):n.val(JSON.stringify(i)),e.preventDefault()}),e.on("change",'[data-name="name"]',function(e){t(this).closest(".long-toolkit-field").find(".long_toolkit_value").change(),e.preventDefault()}),e.on("click","table a.delete",function(e){var n=t(this),i=n.closest(".long-toolkit-field").find("tbody tr"),a=n.closest(".long-toolkit-field").find(".long_toolkit_value");1===i.length?n.closest("tr").find("input").attr("value",""):n.closest("tr").remove(),a.change(),e.preventDefault()}),e.on("click","table a.insert",function(e){var n=t(this).closest("table").find("tbody"),i=n.find("tr:first").clone();i.find("input").attr("value",""),n.append("<tr>"+i.html()+"</tr>"),e.preventDefault()}),e.find("tbody").sortable({items:"tr",cursor:"move",axis:"y",handle:"td.sort",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,stop:function(e,n){t(e.target).closest(".long-toolkit-field").find(".long_toolkit_value").change()}});var n,i={};t(document.body).on("click",".long-toolkit-upload .upload_file",function(e){var a=t(this),l=a.closest(".long-toolkit-field");n=a.closest("tr").find("td.file_url input"),e.preventDefault(),i[l.attr("id")]?i[l.attr("id")].open():(i[l.attr("id")]=wp.media.frames.long_toolkit_file=wp.media({title:a.data("choose"),library:{type:l.data("mime_types")},button:{text:a.data("update")},multiple:!0}),i[l.attr("id")].on("select",function(){var e="";i[l.attr("id")].state().get("selection").map(function(i){i=i.toJSON();var a=l.data("mime_types");""!=t.trim(a)&&-1!==a.indexOf(i.mime)?i.url&&(e=i.url,n.val(e).change(),l.find(".long_toolkit_value").change()):alert(long_toolkit_var.upload_invalid_mime)})}),i[l.attr("id")].open())})},t.fn.ltfwTextfields=function(){var e=t(this),n=e.find(".multitext-item").clone();n.find("input").attr("value","");var i=function(e,n){var i=[],a=t(e.target).closest(".long-toolkit-textfield"),l=a.find("li"),o=a.find(".long_toolkit_value");void 0!==n?o.val("").change():(l.each(function(){""!=t(this).find("input").val()&&i.push(t(this).find("input").val())}),i.length?o.val(encodeURIComponent(JSON.stringify(i))).change():o.val("").change())};e.on("change",".multitext-item input",function(t){i(t)}),e.on("click",".addnew",function(e){t(this).closest(".long-toolkit-textfield").find("ul").append('<li class="multitext-item">'+n.html()+"</li>"),e.preventDefault()}),e.on("click",".remove",function(e){var n=t(this),a=n.closest("ul"),l=n.closest(".multitext-item");a.find(".multitext-item").length>1?(l.remove(),i(e)):(l.find("input").val("").focus(),i(e,"")),e.preventDefault()}),t.fn.sortable&&e.find("ul").sortable({items:".multitext-item",handle:".short",stop:function(t,e){i(t)}})},t.fn.initWidgetDependency=function(){t(this).each(function(){var e=t(this).data("dependency"),n=t(this).data("param_name");if(void 0!=e&&_.isObject(e)){var i="#";t(this).closest(".widget").length&&(i="#widget-"+t(this).closest(".widget").find("input.widget-id").val()+"-");var a=Object.keys(e);_.each(a,function(t){e[i+t]=e[t],delete e[t]}),t("#"+n+".long_toolkit_value").dependsOn(e)}})},t.fn.initRepeaterDependency=function(){t(this).each(function(){var e=t(this).closest(".long_toolkit_repeater__item").index(),n=t(this).closest(".long-toolkit-repeater").attr("data-name")+"-"+e+"-",i=t(this).data("rpt_dependency"),a=t(this).data("param_name");if(void 0!=i&&_.isObject(i)){var l=Object.keys(i);_.each(l,function(t){i["#"+n+t]=i[t],delete i[t]}),t("#"+n+a+".long_toolkit_value").dependsOn(i)}})},t.fn.initMenuDependency=function(){t(this).each(function(){var e=t(this).data("dependency"),n=t(this).data("param_name"),i=t(this).data("menu_item");if(void 0!=e&&"object"==typeof e){var a=Object.keys(e);t.each(a,function(t,n){e["#"+n+"-"+i]=e[n],delete e[n]}),t('[data-param_name="'+n+'"]').dependsOn(e)}})},t.fn.initDependency=function(){t(this).each(function(){var e=t(this).data("dependency"),n=t(this).data("param_name");if(void 0!=e&&"object"==typeof e){var i=Object.keys(e);t.each(i,function(t,n){e["#"+n]=e[n],delete e[n]}),t('[data-param_name="'+n+'"]').dependsOn(e)}})},t.fn.ltfwData=function(){var e=t(this).data(),n={};return t.each(e,function(t,e){var i="";i=t.split("_").length>0?function(t){for(var e=1,n=(t=t.split("_")).length;e<n;e++)t[e]=t[e][0].toUpperCase()+t[e].substr(1);return t.join("")}(t):t,n[i]=e}),n},t.fn.ltfwTextareaHtml=function(){t(this).each(function(){var e=t(this).attr("id");console.log(e),tinymce.get(e)&&wp.editor.remove(e),wp.editor.initialize(e,{tinymce:{wpautop:!0},quicktags:!0})})}});var Long_Toolkit_Repeater_Item=function(t,e,n){"use strict";var i=this;this.list=t,this.container=e,this.control=t.prev(".long_toolkit_value"),this.container.on("keyup change",".long_toolkit_value",function(t){i.setValues()}),this.setValues=function(){var t=[];i.list.find("[data-repeater-item]").each(function(){var e={};jQuery(this).find(".long_toolkit_value").each(function(){var t=jQuery(this);if("radio"!=t.attr("type")||"radio"==t.attr("type")&&t.is(":checked")){var n=jQuery(this).attr("name").match(/\[([^\]]*)(\]|\]\[\])$/)[1];e[n]=jQuery(this).val()}}),t.push(e)}),i.control.val(JSON.stringify(t)).trigger("change")},n&&i.setValues()};